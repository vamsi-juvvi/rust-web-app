<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="862px" preserveAspectRatio="none" style="width:673px;height:862px;background:#FFFFFF;" version="1.1" viewBox="0 0 673 862" width="673px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFF00" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="99.9736" x="10" y="411.8594"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79.9736" x="20" y="434.8545">Auth Token</text><rect fill="#FFB6C1" height="52.5938" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="378.2373" x="159.9736" y="20"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="358.2373" x="169.9736" y="42.9951">Dont store anything beyond user-id and signatures</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="232.3193" x="169.9736" y="59.292">Anything stored gives attack info</text><path d="M109.9736,430.0078 L119.9736,430.0078 C134.9736,430.0078 134.9736,46.2969 149.9736,46.2969 L159.9736,46.2969 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#90EE90" height="68.8906" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="307.1914" x="159.9736" y="92.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="282.7412" x="174.4238" y="115.5889">Token validity aside, handle revocations</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="146.6855" x="174.4238" y="131.8857">- Fetch ACLs from db</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="230.6514" x="174.4238" y="148.1826">- Fetch token revocation from db</text><path d="M109.9736,430.0078 L119.9736,430.0078 C134.9736,430.0078 134.9736,127.0391 149.9736,127.0391 L159.9736,127.0391 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="52.5938" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="255.6484" x="159.9736" y="181.4844"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="235.6484" x="169.9736" y="204.4795">Hash key comes from config.toml</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="24.5205" x="169.9736" y="220.7764">see</text><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="94.9512" x="198.9443" y="220.7764">tools/gen-key</text><path d="M109.9736,430.0078 L119.9736,430.0078 C134.9736,430.0078 134.9736,207.7813 149.9736,207.7813 L159.9736,207.7813 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#90EE90" height="85.1875" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="390.9521" x="159.9736" y="254.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="152.2227" x="169.9736" y="277.0732">Store token-cookie as</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="69.166" x="169.9736" y="293.3701">httpOnly</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="151.3066" x="169.9736" y="309.667">so JS cannot access it</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="67.5596" x="169.9736" y="325.9639">path="/"</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="298.9424" x="241.9834" y="325.9639">making it global and sent to every request</text><path d="M109.9736,430.0078 L119.9736,430.0078 C134.9736,430.0078 134.9736,296.6719 149.9736,296.6719 L159.9736,296.6719 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#FFA500" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="131.5762" x="159.9736" y="581.4922"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111.5762" x="169.9736" y="604.4873">mw_ctx_resolve</text><rect fill="#90EE90" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="230.916" x="341.5498" y="359.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104.3438" x="351.5498" y="382.2607">Middleware for</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="44.1465" x="460.3438" y="382.2607">every</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53.5254" x="508.9404" y="382.2607">request</text><path d="M291.5498,599.6406 L301.5498,599.6406 C316.5498,599.6406 316.5498,377.4141 331.5498,377.4141 L341.5498,377.4141 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="320.4121" x="341.5498" y="415.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="49.9092" x="351.5498" y="438.5576">extract</text><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="158.8262" x="405.9092" y="438.5576">user_name, expiry, sig</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82.7764" x="569.1855" y="438.5576">from cookie</text><path d="M291.5498,599.6406 L301.5498,599.6406 C316.5498,599.6406 316.5498,433.7109 331.5498,433.7109 L341.5498,433.7109 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="150.375" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="255.3408" x="341.5498" y="471.8594"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="235.3408" x="351.5498" y="494.8545">based on user-name, get from db</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4502" x="351.5498" y="511.1514">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87.0967" x="351.5498" y="527.4482">UserForAuth</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="8.9072" x="356" y="543.7451">{</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62.0225" x="369.3506" y="560.042">id: 1000,</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="149.7959" x="369.3506" y="576.3389">username : "demo1",</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116.04" x="369.3506" y="592.6357">token_salt : uuid</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="8.9072" x="356" y="608.9326">}</text><path d="M291.5498,599.6406 L301.5498,599.6406 C316.5498,599.6406 316.5498,547.0469 331.5498,547.0469 L341.5498,547.0469 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="52.5938" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="201.4258" x="341.5498" y="642.2344"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="176.8047" x="351.5498" y="665.2295">validate cookie signature</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37.8164" x="351.5498" y="681.5264">using</text><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="139.1592" x="393.8164" y="681.5264">token_salt, app_key</text><path d="M291.5498,599.6406 L301.5498,599.6406 C316.5498,599.6406 316.5498,668.5313 331.5498,668.5313 L341.5498,668.5313 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="198.5342" x="341.5498" y="714.8281"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="145.1953" x="351.5498" y="737.8232">check expiry against</text><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="28.8887" x="501.1953" y="737.8232">now</text><path d="M291.5498,599.6406 L301.5498,599.6406 C316.5498,599.6406 316.5498,732.9766 331.5498,732.9766 L341.5498,732.9766 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#90EE90" height="68.8906" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="238.7568" x="341.5498" y="771.125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="218.7568" x="351.5498" y="794.1201">extend expiry by small amount</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="150.4111" x="356" y="810.417">- generate new token</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="125.5488" x="356" y="826.7139">- save new cookie</text><path d="M291.5498,599.6406 L301.5498,599.6406 C316.5498,599.6406 316.5498,805.5703 331.5498,805.5703 L341.5498,805.5703 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><path d="M109.9736,430.0078 L119.9736,430.0078 C134.9736,430.0078 134.9736,599.6406 149.9736,599.6406 L159.9736,599.6406 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><!--SRC=[RLDTRzf047o_Nx6YBua5CKHH4pcgb3GVhIWeKKdoKY6qs8jzmhvpxzOGg-f_xvu1eLRbpNixkxCpmurdT5nfarLOg-Z7XvRAqcxdSDjm0IzsJKP5KYvrNd2jpNgUt5l3uDaw0ZGj5zhaiAJMcWmQJswWCwbdu7Lka1j7NjqUsZfK1hdUa0TandGDsgpijJekoHsHcIUxtR31KcUQMq2lC-f38QDB0aSRco9hQpme6C0ZSLh0xTt4myhP2hBbiShTe2FYqD4jJRwYBs1DBQIseZqwjMQbypEsLQay4SGnMrlwE2SpaDOu_W_VMIT8jskGMhlMeewNheAvVZ9b6qNAMnZF84LZB0EcANaFcgMdHYu-zU9U5465wo2KPiXBkyHo9oM9uco1DkHQkUHdGvxt7An3azCSgkqYvVU5o6tB3SdJt_nWgZCHRej2ScKTH54tJ3RknmK4q3ixJ5aE3auk35OYERtNshNzO6WS7mGA1mP84iTBzEAfwDgvlyFan0UPurYfLtbvj2vaIi4l1VBJMGAZuN3Oxxu2D20XWLv6bHtrTlLEpuN7akMbQNIcu7TtU9HqoK2cFPbZta0rFcWON3kW-u1rlJXw5q5Qa8HlTnjWZjhuSBUnMo7yhtg924DYnBvzsOAli1HpAjiO3b6JQ90BR0njTwn3rUDcLzbnl5OtCkNmPrFF9Hf-dKv0dF0XcAEpy-7vnTdboGmPPbJ3y196esHqbOmkuVNb3iBpgJhvyZm1RnkN4cJQizFB9WJxL8rnW_1TAEcA4dYgoOpllnqAy60ssbbJIPhK-6rwRFXuCVYimqOdJE1jgkvfXOre_c1IcucMYMn_75ofYMIjmLncotrtuNRNojli3m00]--></g></svg>